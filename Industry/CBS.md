# CBS(Tencent)

>CBS提供高可靠、高可用、低成本的**块级**网络存储服务
>CBS盘以**普通块设备**的方式挂载到服务器上，可以作为服务器系统盘分区或数据盘分区。当被挂载的服务器出现故障时，可以把CBS盘重新挂在到新的服务器上，**重现数据**
>CBS云盘在使用方式上与本地块设备**完全相同**，能够以**裸盘或者挂载文件系统**的方式来使用
>CBS盘支持**各种应用场景下的数据存储**，如图片、日志、视频文件，运行关系型数据库（如MySQL）、非关系型数据库等各类存储系统。

## 技术架构
![[Pasted image 20220124142608.png]]

CBS系统包括3部分：
- **CBS Core System**：CBS核心系统，提供快存储服务
- **CBS Snapshot/Scheduler System**：CBS快照/调度系统，提供快照异构存储，支持快照的创建、回滚操作；提供逻辑卷的跨仓库调度能力；  
- **CBS OSS System**：CBS运管系统，提供CBS系统操作的API，提供运营管理界面

## CBS 核心系统
![[Pasted image 20220124142955.png]]
CBS 核心系统包含3个部署模块：  
- **driver**：部署在客户端，提供块存储访问能力  
- **cell**：存储节点，提供数据存储服务（类似于Worker）  
- **master**：机器中控节点，负责CBS机群的逻辑卷和路由管理

## CBS快照/调度系统
![[Pasted image 20220124144038.png]]
快照/调度系统模块

-   Manager
    -   快照/调度系统入口，请求控制流
    -   快照/调度系统拓扑
    -   维护快照记录及快照链
-   Scheduler
    -   数据/调度搬迁层
    -   快照元数据维护以及搬迁数据一致性保证
-   Transfer
    -   数据搬迁，使用CBS SDK读写块存储数据，COS SDK上传下载到COS对象存储集群

元数据持久层

-   DB
    -   快照记录，如大小，时间等
    -   快照链
    -   快照系统拓扑结构
-   Zookeeper集群
    -   快照/迁移点元数据，如bitmap

数据持久层：COS存储快照数据


CBS运管系统
![[Pasted image 20220124144142.png]]


## CBS云硬盘产品
### 云硬盘类型
- 根据生命周期的不同，云硬盘可分为：
	- 非弹性云硬盘的生命周期完全跟随云服务器 ，随云服务器一起购买并作为系统盘使用，不支持挂载与卸载。
	- 弹性云硬盘的生命周期独立于云服务器，可单独购买然后手动挂载至云服务器，也可随云服务器一起购买并自动挂载至该云服务器，作为数据盘使用。弹性云硬盘支持随时在同一可用区内的云服务器上挂载或卸载。您可以将多块弹性云硬盘挂载至同一个云服务器，也可以将弹性云硬盘从云服务器 A 中卸载然后挂载到云服务器 B。
- 根据所用存储介质的不同，可以分为：
	- **高性能云硬盘**
	- **SSD 云硬盘**
	- **增强型 SSD 云硬盘**
	- **极速型 SSD 云硬盘**
![[Pasted image 20220124152534.png]]
### 云硬盘的典型应用场景
- 去本地化（业务上云）
- 海量数据分析
- 核心数据库
- 整点数据落盘（每日的整点时刻，往磁盘同步大量数据【数据异步落盘】）
- 周期性超高负载
	- 游戏场景：高峰时间段，应用程序传递到文件系统，再传递到块设备的IO请求都为随机小IO（4KB/8KB/16KB不等），峰值需求超过2万IOPS
- 持续高顺序读写
	- 典型的Spark-HDFS离线数据分析框架，对于磁盘的读写。RDD read/write，shuffle write都是顺序IO

### 云硬盘生命周期
![[Pasted image 20220124161433.png]]
